import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as a,c as s,a as e}from"./app-x8bEfOWx.js";const t={},p=e(`<h1 id="_11、闭包" tabindex="-1"><a class="header-anchor" href="#_11、闭包"><span>11、闭包</span></a></h1><h1 id="闭包" tabindex="-1"><a class="header-anchor" href="#闭包"><span>闭包</span></a></h1><h2 id="经典真题" tabindex="-1"><a class="header-anchor" href="#经典真题"><span>经典真题</span></a></h2><ul><li>闭包是什么？闭包的应用场景有哪些？怎么销毁闭包？</li></ul><h2 id="什么是闭包" tabindex="-1"><a class="header-anchor" href="#什么是闭包"><span>什么是闭包</span></a></h2><p>闭包，是 <em>JavaScript</em> 中一个非常重要的知识点，也是我们前端面试中较高几率被问到的知识点之一。</p><p>打开《<em>JavaScript</em> 高级程序设计》和《 <em>JavaScript</em> 权威指南》，会发现里面针对闭包的解释各执一词，在网络上搜索关于闭包的内容，也发现众说纷纭，这就导致了这个知识点本身显得有点神秘，甚至还有一点玄幻。</p><p>那么这个知识点真的有那么深奥么？</p><p>非也！其实要理解 <em>JavaScript</em> 中的闭包，非常容易，但是在此之前你需要先知道以下两个知识点：</p><ul><li><em>JavaScript</em> 中的作用域和作用域链</li><li><em>JavaScript</em> 中的垃圾回收</li></ul><p>这里我们来简单回顾一下这两个知识点：</p><p><strong>1. <em>JavaScript</em> 中的作用域和作用域链</strong></p><ul><li>作用域就是一个独立的地盘，让变量不会外泄、暴露出去，不同作用域下同名变量不会有冲突。</li><li>作用域在定义时就确定，并且不会改变。</li><li>如果在当前作用域中没有查到值，就会向上级作用域去查，直到查到全局作用域，这么一个查找过程形成的链条就叫做作用域链。</li></ul><p><strong>2. <em>JavaScript</em> 中的垃圾回收</strong></p><ul><li><em>Javascript</em> 执行环境会负责管理代码执行过程中使用的内存，其中就涉及到一个垃圾回收机制</li><li>垃圾收集器会定期（周期性）找出那些不再继续使用的变量，只要该变量不再使用了，就会被垃圾收集器回收，然后释放其内存。如果该变量还在使用，那么就不会被回收。</li></ul><p><em>OK</em>，有了这 <em>2</em> 个知识点的铺垫后，接下来我们再来看什么是闭包。</p><blockquote><p>闭包不是一个具体的技术，而是一种现象，是指在定义函数时，周围环境中的信息可以在函数中使用。换句话说，执行函数时，只要在函数中使用了外部的数据，就创建了闭包。</p><p>而作用域链，正是实现闭包的手段。</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> food <span class="token operator">=</span> <span class="token string">&#39;鸡翅&#39;</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>food<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> look <span class="token operator">=</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">look</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 鸡翅</span>
<span class="token function">look</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 鸡翅</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，闭包的一个优点或者特点也就体现出来了，那就是：</p><ul><li>通过闭包可以让外部环境访问到函数内部的局部变量。</li><li>通过闭包可以让局部变量持续保存下来，不随着它的上下文环境一起销毁。</li></ul><h3 id="经典真题-1" tabindex="-1"><a class="header-anchor" href="#经典真题-1"><span>经典真题</span></a></h3><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在上面的代码中，我们预期的结果是过 <em>1</em> 秒后分别输出 <em>i</em> 变量的值为 <em>1，2，3</em>。但是，执行的结果是：<em>4，4，4</em>。</p><p>实际上，问题就出在闭包身上。你看，循环中的 <em>setTimeout</em> 访问了它的外部变量 <em>i</em>，形成闭包。</p><p>而 <em>i</em> 变量只有 <em>1</em> 个，所以循环 <em>3</em> 次的 <em>setTimeout</em> 中都访问的是同一个变量。循环到第 <em>4</em> 次，<em>i</em> 变量增加到 <em>4</em>，不满足循环条件，循环结束，代码执行完后上下文结束。但是，那 <em>3</em> 个 <em>setTimeout</em> 等 <em>1</em> 秒钟后才执行，由于闭包的原因，所以它们仍然能访问到变量 <em>i</em>，不过此时 <em>i</em> 变量值已经是 <em>4</em> 了。</p><p>要解决这个问题，我们可以让 <em>setTimeout</em> 中的匿名函数不再访问外部变量，而是访问自己内部的变量，如下：</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">index</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样 <em>setTimeout</em> 中就可以不用访问 <em>for</em> 循环声明的变量 <em>i</em> 了。而是采用调用函数传参的方式把变量 <em>i</em> 的值传给了 <em>setTimeout</em>，这样它们就不再创建闭包，因为在我自己的作用域里面能够找到 <em>i</em> 这个变量。</p><p>当然，解决这个问题还有个更简单的方法，就是使用 <em>ES6</em> 中的 <em>let</em> 关键字。</p><p>它声明的变量有块作用域，如果将它放在循环中，那么每次循环都会有一个新的变量 <em>i</em>，这样即使有闭包也没问题，因为每个闭包保存的都是不同的 <em>i</em> 变量，那么刚才的问题也就迎刃而解。</p><div class="language-javascript line-numbers-mode" data-ext="js" data-title="js"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,31),o=[p];function c(i,l){return a(),s("div",null,o)}const m=n(t,[["render",c],["__file","11、闭包.html.vue"]]),d=JSON.parse('{"path":"/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/%E6%B8%A1%E4%B8%80%E5%89%8D%E7%AB%AF/11%E3%80%81%E9%97%AD%E5%8C%85.html","title":"11、闭包","lang":"zh-CN","frontmatter":{"star":true,"category":["JS基础"],"description":"11、闭包 闭包 经典真题 闭包是什么？闭包的应用场景有哪些？怎么销毁闭包？ 什么是闭包 闭包，是 JavaScript 中一个非常重要的知识点，也是我们前端面试中较高几率被问到的知识点之一。 打开《JavaScript 高级程序设计》和《 JavaScript 权威指南》，会发现里面针对闭包的解释各执一词，在网络上搜索关于闭包的内容，也发现众说纷纭，...","head":[["meta",{"property":"og:url","content":"https://mister-hope.github.io/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/%E6%B8%A1%E4%B8%80%E5%89%8D%E7%AB%AF/11%E3%80%81%E9%97%AD%E5%8C%85.html"}],["meta",{"property":"og:site_name","content":"ErWin的博客"}],["meta",{"property":"og:title","content":"11、闭包"}],["meta",{"property":"og:description","content":"11、闭包 闭包 经典真题 闭包是什么？闭包的应用场景有哪些？怎么销毁闭包？ 什么是闭包 闭包，是 JavaScript 中一个非常重要的知识点，也是我们前端面试中较高几率被问到的知识点之一。 打开《JavaScript 高级程序设计》和《 JavaScript 权威指南》，会发现里面针对闭包的解释各执一词，在网络上搜索关于闭包的内容，也发现众说纷纭，..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-10T07:11:45.000Z"}],["meta",{"property":"article:author","content":"Mr.ErWin"}],["meta",{"property":"article:modified_time","content":"2024-04-10T07:11:45.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"11、闭包\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-10T07:11:45.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Mr.ErWin\\",\\"url\\":\\"https://gitee.com/destiny12327\\"}]}"]]},"headers":[{"level":2,"title":"经典真题","slug":"经典真题","link":"#经典真题","children":[]},{"level":2,"title":"什么是闭包","slug":"什么是闭包","link":"#什么是闭包","children":[{"level":3,"title":"经典真题","slug":"经典真题-1","link":"#经典真题-1","children":[]}]}],"git":{"createdTime":1712733105000,"updatedTime":1712733105000,"contributors":[{"name":"ma","email":"destiny0402@163.com","commits":1}]},"readingTime":{"minutes":3.77,"words":1132},"filePathRelative":"面试笔记/渡一前端/11、闭包.md","localizedDate":"2024年4月10日","excerpt":"\\n<h1>闭包</h1>\\n<h2>经典真题</h2>\\n<ul>\\n<li>闭包是什么？闭包的应用场景有哪些？怎么销毁闭包？</li>\\n</ul>\\n<h2>什么是闭包</h2>\\n<p>闭包，是 <em>JavaScript</em> 中一个非常重要的知识点，也是我们前端面试中较高几率被问到的知识点之一。</p>\\n<p>打开《<em>JavaScript</em> 高级程序设计》和《 <em>JavaScript</em> 权威指南》，会发现里面针对闭包的解释各执一词，在网络上搜索关于闭包的内容，也发现众说纷纭，这就导致了这个知识点本身显得有点神秘，甚至还有一点玄幻。</p>\\n<p>那么这个知识点真的有那么深奥么？</p>","autoDesc":true}');export{m as comp,d as data};
